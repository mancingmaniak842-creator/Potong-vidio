name: YouTube Cutter

on:
  workflow_dispatch:
    inputs:
      url:
        description: "YouTube URL"
        required: true
      start:
        description: "Start time (e.g. 00:00:10)"
        required: true
      end:
        description: "End time (e.g. 00:00:30)"
        required: true

jobs:
  cut-upload:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg
          pip install yt-dlp
          curl https://rclone.org/install.sh | sudo bash

      - name: Setup rclone config
        run: |
          mkdir -p ~/.config/rclone
          echo "${{ secrets.RCLONE_CONF }}" > ~/.config/rclone/rclone.conf

      - name: Debug rclone.conf
        run: |
          echo "===== rclone.conf ====="
          cat ~/.config/rclone/rclone.conf | sed 's/access_token.*/access_token":"***"/'

      - name: Download YouTube video (with cookies)
        run: |
          echo "${{ secrets.YT_COOKIES }}" > cookies.txt
          yt-dlp --cookies cookies.txt -f "bestvideo+bestaudio/best" -o "input.%(ext)s" "${{ github.event.inputs.url }}"

      - name: Cut video
        run: |
          in_file=$(ls input.* | head -n 1)
          ffmpeg -i "$in_file" -ss ${{ github.event.inputs.start }} -to ${{ github.event.inputs.end }} -c copy output.mp4

      - name: Upload to Google Drive
        run: |
          rclone mkdir gdrive:YouTube-Cut || true
          rclone copy output.mp4 gdrive:YouTube-Cut -P
