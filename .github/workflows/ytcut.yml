name: YouTube Cut (dengan cookies dari Secret)

on:
  workflow_dispatch:
    inputs:
      url:
        description: "URL YouTube"
        required: true
      start:
        description: "Waktu mulai (misal: 00:01:23)"
        required: true
      end:
        description: "Waktu selesai (misal: 00:02:34)"
        required: true
      resolution:
        description: "Resolusi maksimal (misal: 1080, 1440, 2160)"
        required: false
        default: "1080"

jobs:
  cut:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install tools
        run: |
          sudo apt update
          sudo apt install -y ffmpeg
          pip install yt-dlp

      - name: Buat file cookies dari Secret
        run: |
          echo "${{ secrets.YT_COOKIES }}" > cookies.txt
          ls -l cookies.txt

      - name: Download & Cut langsung (pakai yt-dlp)
        run: |
          yt-dlp --cookies cookies.txt \
            --download-sections "*${{ github.event.inputs.start }}-${{ github.event.inputs.end }}" \
            -f "bestvideo[height<=${{ github.event.inputs.resolution }}]+bestaudio/best[height<=${{ github.event.inputs.resolution }}]" \
            -o "output.%(ext)s" \
            "${{ github.event.inputs.url }}"

      - name: Encode ulang biar CapCut friendly
        run: |
          ffmpeg -i output.* \
            -c:v libx264 -preset fast -crf 23 \
            -c:a aac -b:a 192k \
            -movflags +faststart \
            final.mp4

      - name: Upload hasil sebagai artifact
        uses: actions/upload-artifact@v4
        with:
          name: youtube-cut
          path: final.mp4
